---
title: "R-club-May-10"
author: "Min-Yao"
date: "2017年5月7日"
output: 
  html_document: 
    keep_md: yes
---

# 5 Data transformation

## 5.1 Introduction

### 5.1.1 Prerequisites

```{r}
library(nycflights13)
library(tidyverse)
```

### 5.1.2 nycflights13

```{r}
flights
View(flights)

```

### 5.1.3 dplyr basics

## 5.2 Filter rows with filter()
```{r}
filter(flights, month == 1, day == 1)
jan1 <- filter(flights, month == 1, day == 1)
(dec25 <- filter(flights, month == 12, day == 25))

```

### 5.2.1 Comparisons

```{r}
sqrt(2) ^ 2 == 2
1/49 * 49 == 1

near(sqrt(2) ^ 2,  2)
near(1 / 49 * 49, 1)
```

### 5.2.2 Logical operators

```{r}
filter(flights, month == 11 | month == 12)
nov_dec <- filter(flights, month %in% c(11, 12))

filter(flights, !(arr_delay > 120 | dep_delay > 120))
filter(flights, arr_delay <= 120, dep_delay <= 120)
```

### 5.2.3 Missing values

```{r}
NA > 5
10 == NA
NA + 10
NA / 2

NA == NA
x <- NA
y <- NA
x == y

is.na(x)

df <- tibble(x = c(1, NA, 3))
filter(df, x > 1)
filter(df, is.na(x) | x > 1)
```

### 5.2.4 Exercises

1.
```{r}
#1
?flights
airlines
##1
filter(flights, dep_delay >= 2)
##2
filter(flights, dest == "IAH" | dest == "HOU")
##3
filter(flights, carrier == "AA" | carrier == "UA" | carrier == "DL")
##4
filter(flights, month %in% c(7, 8, 9))
##5
filter(flights, arr_delay >= 120 & dep_delay <= 0)
##6
filter(flights, dep_delay >= 60 & dep_delay - arr_delay > 30)
##7
filter(flights, dep_time >= 0000 & dep_time <= 0600)
       
```

2.
```{r}
#2
?between()

##7
filter(flights, between(dep_time, 0000, 0600))
```

> This is a shortcut for x >= left & x <= right, implemented efficiently in C++ for local values, and translated to the appropriate SQL for remote tables. between(x, left, right). Yes.

3.
```{r}
filter(flights, is.na(dep_time))
```

4.
```{r}
NA ^ 0
NA | TRUE
FALSE & NA
NA * 0

```

## 5.3 Arrange rows with arrange()


```{r}
arrange(flights, year, month, day)
arrange(flights, desc(arr_delay))

df <- tibble(x = c(5, 2, NA))
arrange(df, x)

arrange(df, desc(x))
```

### 5.3.1 Exercises

1.How could you use arrange() to sort all missing values to the start? (Hint: use is.na()).
```{r}
df <- tibble(x = c(5, 2, NA))
arrange(df, x)
arrange(df, desc(is.na(x)))
```

2.Sort flights to find the most delayed flights. Find the flights that left earliest.
```{r}
arrange(flights, desc(arr_delay))
arrange(flights, dep_delay)
```

3. Sort flights to find the fastest flights.
```{r}
arrange(flights, air_time)
```

4. Which flights travelled the longest? Which travelled the shortest?
```{r}
arrange(flights, distance)
arrange(flights, desc(distance))
```

